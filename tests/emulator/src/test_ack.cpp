#include <sys/mman.h>
#include <cstdint>
#include <cstdio>
#include <cstring>
#include <vector>

std::vector<uint8_t> instructions { 0x48, 0x85, 0xFF, 0x74, 0x02, 0x75, 0x07, 0x48, 0xFF, 0xC6, 0x48, 0x89, 0xF0, 0xC3, 0x48, 0x85, 0xF6, 0x74, 0x02, 0x75, 0x0C, 0x48, 0xFF, 0xCF, 0x48, 0xFF, 0xC6, 0xE8, 0xE0, 0xFF, 0xFF, 0xFF, 0xC3, 0x48, 0xFF, 0xCE, 0x57, 0xE8, 0xD6, 0xFF, 0xFF, 0xFF, 0x48, 0x89, 0xC6, 0x5F, 0x48, 0xFF, 0xCF, 0xE8, 0xCA, 0xFF, 0xFF, 0xFF, 0xC3 }  ;

int main() {
    void* ptr = ::mmap(nullptr, 0x1000, PROT_WRITE | PROT_READ | PROT_EXEC, MAP_PRIVATE | MAP_ANONYMOUS, 0, 0);
    if(ptr == (void*)MAP_FAILED) {
        perror("mmap");
        return 1;
    }

    std::memset(ptr, 0, 0x1000);
    std::memcpy(ptr, instructions.data(), instructions.size());

    using ack_ptr = uint64_t(*)(uint64_t, uint64_t);

    ack_ptr ack = (ack_ptr)ptr;
    uint64_t m = 3;
    uint64_t n = 5;
    uint64_t value = ack(m, n);

    printf("ack(%llu, %llu) = %llu\n", m, n, value);
    return 0;
}